# KC Management Flow and Notes

## User Access Levels

### Council Roles
- **Financial Secretary** (Full Access)
- **Treasurer** (Full Access)
- **Grand Knight** (Read Access)
- **Deputy Grand Knight** (Read Access)
- **Program Director** (Read Access)
- **Membership Director** (Read Access)
- **Knight** (Basic Access)

### Assembly Roles
- **Faithful Comptroller** (Full Access)
- **Faithful Purser** (Full Access)
- **Faithful Navigator** (Read Access)
- **Faithful Captain** (Read Access)
- **Program Director** (Read Access)
- **Membership Director** (Read Access)
- **Sir Knight** (Basic Access)

### Access Level Definitions

**Basic Access**: Ability to enter data into programs and volunteer hours. Users cannot see the finance screen or have it as a choice in the navbar. They have access to the program budget report (shows approved budget amount for one program at a time, and how much income and expenses it has accumulated in the calendar year).

**Read Access**: Basic access plus read-only access to financial screen and financial reports, excluding budget generation (where the budget is determined for the calendar year).

**Full Access**: Access to add financial data, run all reports, and generate budget.

### User Membership Rules
- A user will always be a member of a council and have a council number
- They may also be a member of an assembly and have an assembly number
- Users cannot be a member of an assembly without being a member of a council

## Subscriptions

The system will have 2 subscription options:

### Single Access
A user who is a member of a council and maybe assembly uses the app, but the council or assembly is not participating as an organization.

- **Basic User**: No cost, ever
- **Read Access**: May not be available in single access (most financial data they can see is generated by Full Access users, so they would only see 0s or null data)
- **Full Access**: $1.99 or $2.99 per year, annual subscription, 90 days free to start (subscription starts on subscription_start + 91 days)

### Organization Access
An organization (council or assembly) pays for a group membership. Certain people are granted the correct access level based on their roles and are connected to the organization so they don't get billed for Single Access.

**Organization Pricing**: $9.99 per year includes:
- 1 Financial Secretary/Faithful Comptroller
- 1 Treasurer/Faithful Purser
- 1 Grand Knight/Faithful Navigator
- 1 Deputy Grand Knight/Faithful Captain
- 1 Program Director
- 1 Membership Director
- Unlimited Knight/Sir Knight

*Note: The role on the right of each "/" is for the assembly. Both assembly and council can have a program director and membership director.*

## User Authentication Flow

1. All unauthenticated users start at the login/main screen
2. System can maintain authentication for previously authenticated users
3. User authenticates
4. New users have their authentication saved in Supabase, as well as user data in the users table
5. User access level is determined by the users table and access is granted based on those roles
6. New users are given basic access (assumed to be knight or sir knight)
7. User subscription status is checked with RevenueCat. Higher access users are denied access to their normal areas and sent to a subscription renewal screen if needed
8. Consider having brand new users default to the profile screen to fill in their user data and roles, save their profile data, then go to main/Home screen (only on first time)

## Profile Screen

### Required Data
- First Name
- Last Name
- Membership Number
- Council Number
- Council Role

### Optional Data
- Assembly Number
- Assembly Role

### Additional Features
- Full Access users can enter the Define Programs area and create new programs, edit/toggle programs on/off (both system defaults and custom programs)
- All users can sign out
- Consider adding a Delete Account button that allows users to delete their personal data (their line in the users table, volunteer hours they logged), but won't delete other submitted data as it belongs to the organization

## Define Programs Screen

### System Programs
- System default programs exist for councils and assemblies
- Some programs are the same for both, others are specific to councils or assemblies

### Program Management
- Full access users can toggle programs on/off based on organization participation (active/inactive)
- Users can add custom programs for their organization
- Programs can be toggled on and off
- Active/inactive status determines visibility in dropdowns throughout the app
- Program choices are saved in the database so all members of the same organization see the same active/inactive programs

## Organization Choice/Buttons/Toggles

### Organization Data Separation
- When a user is in one organization (council or assembly), they only see that group's data
- If on council, they only see council data, not assembly data
- If in assembly, they don't see council data

### Access Level Management
- Access to areas is limited/unlimited based on their access for that specific organization
- Access levels can be completely different between organizations
- Example: User could be a Knight (basic access) in council but Faithful Comptroller (full access) in assembly
- Finance would not be visible when toggled to council but accessible when toggled to assembly

## Main/Home Screen

Personal dashboard area where users can add whatever components they want:
- Income and expense entry components
- Program budget check component
- Customizable based on user preferences
- Can have no components if desired

### Navigation
- Navbar at the bottom with access to approved areas
- Organization buttons at the top
- If user hasn't provided assembly number and role, Assembly button is disabled
- Council button is never disabled (users must be members of a council)
- Organization buttons default to Council when moving to other screens/components

## Programs

### Access and Features
- All users can log programs regardless of access level
- User chooses appropriate organization button to proceed
- User submits program data (gets saved to Programs table)

### Program Log
- Toggle to view previously submitted entries
- Shows newest entries on top
- Grouped by year/month (collapsible groupings)
- Shows all entries submitted for that organization by any user in that organization
- User only sees entries for selected organization

## Hours

### Volunteer Hours Logging
- All users can log volunteer hours regardless of access level
- User chooses appropriate organization button to proceed
- User submits volunteer hour data (gets saved to hours_entries)

### Hours Log Features
- Toggle to view previously submitted entries
- Shows newest entries on top
- Grouped by year/month (collapsible groupings)
- Users can edit or delete their previously submitted entries
- Users only see their own entries, regardless of access or organization
- Users can see all their data even when switching councils

## Finance

### Access Requirements
- Not accessible for anyone less than full users
- Finance shouldn't display on navbar for non-full users

### Features
- User submits income or expense entries (saved to finance_entries)
- View log works the same as other screens
- Full users can edit or delete previously submitted entries

## Reports

### Balance Sheet
- **Access**: Full access only
- Breaks down all financial entries
- Totals for each program by month
- Separates income and expense entries
- All 12 months in calendar year as columns

### Annual Budget Report
- **Access**: Full access only
- Provides fields for users to submit budget numbers for each program
- Saves to budget_entries
- Budget numbers for upcoming year can be changed until beginning of year
- Once new year starts, numbers are set and can't be changed
- Currently 2025: Can change 2026 budget numbers until Jan 1, 2026

### Semi-Annual Audit Report
- **Access**: Full access only
- Pulls data from financial data within selected period
- Collects user-entered data
- Runs calculations to fill in a fill-in PDF
- Uses Supabase functions to help fill in PDF

### Form 1728
- **Access**: Read or Full Access
- Pulls data from submitted programs data for calendar year
- Fills in a fill-in PDF

### Program Budget
- **Access**: Read or Full Access
- Reads chosen program budget number from submitted budget for matching year
- Pulls income and expense entries to calculate current totals
- Calculates remaining budget (income - expenses Â± approved budget)

### Volunteer Hours
- **Access**: All access levels
- Totals volunteer hours for calendar year for that user based on submitted hours

## Additional Features - Reimbursement System

### Reimbursement Flow
1. User clicks on "Receipts" (or similar)
2. Choose organization for proper routing
3. Enter information:
   - First and Last Name
   - Email address
   - Phone number
   - Program (based on define programs toggles)
   - Description of what it's for
   - Amount
4. Submit documentation:
   - PDF upload
   - Previously made image (JPG/PNG)
   - Take picture immediately
5. Specify recipient:
   - For themselves
   - For donation to other entity (e.g., Special Olympics of Colorado)
6. Choose delivery method:
   - Check at next meeting
   - Mail to address
7. Provide mailing address

### Approval Process
1. User submits request
2. Notification sent to organization's financial officer (Financial Secretary or Comptroller)
3. Officer reviews and either approves or denies with reason
4. **If denied**: Email generated to submitting user with denial reason, user can correct and resubmit
5. **If approved**: Becomes a voucher with unique number (e.g., CE013 for 13th Council Electronic voucher)
6. Notification/email sent to other financial officer (Treasurer/Purser) about approved voucher
7. Treasurer/Purser writes check and either saves for next meeting or mails as specified
8. Expense is automatically submitted into expense entries

### Notes
- Officer should not manually submit expense entry as it will be generated automatically
- System should track voucher numbers and generate unique identifiers