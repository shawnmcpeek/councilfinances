# KC Management Flow and Notes

## User Access Levels

### Council Roles
- **Financial Secretary** (Full Access)
- **Treasurer** (Full Access)
- **Grand Knight** (Read Access)
- **Deputy Grand Knight** (Read Access)
- **Program Director** (Read Access)
- **Membership Director** (Read Access)
- **Knight** (Basic Access)

### Assembly Roles
- **Faithful Comptroller** (Full Access)
- **Faithful Purser** (Full Access)
- **Faithful Navigator** (Read Access)
- **Faithful Captain** (Read Access)
- **Program Director** (Read Access)
- **Membership Director** (Read Access)
- **Sir Knight** (Basic Access)

### Access Level Definitions

**Basic Access:**
- Ability to enter data into programs and volunteer hours
- Cannot see the finance screen or have it as a choice in the navbar
- Access to the program budget report (shows approved budget amount for one program at a time, and how much income and expenses it has accumulated in the calendar year)

**Read Access:**
- Basic access plus read-only access for financial screen and financial reports
- Excludes budget generation (where the budget is determined for the calendar year)

**Full Access:**
- Access to add financial data
- Run all reports
- Generate budget

### Membership Structure
- A user will always be a member of a council and have a council number
- They may also be a member of an assembly and have an assembly number
- Users cannot be a member of an assembly and not a member of a council

## Subscriptions

### Single Access
A user who is a member of a council and maybe assembly uses the app but the council or assembly is not participating as an organization.

- **Basic User:** No cost, ever
- **Read Access:** Probably not available in single access as most of the financial data they can see is generated by other Full Access users, so all they would ever see is 0s or null data
- **Full Access:** $1.99 or $2.99 per year, annual subscription, 90 days free to start (subscription starts on `subscription_start + 91` days - need to format correctly as datetime/timestamp+91 will throw an error)

### Organization Access
An organization (council or assembly) pays for a group membership and certain people are granted the correct access level based on their roles and are connected to the organization so they don't get billed for Single Access.

**Organization Pricing:** $9.99 per year for:
- 1 Financial Secretary/Faithful Comptroller
- 1 Treasurer/Faithful Purser
- 1 Grand Knight/Faithful Navigator
- 1 Deputy Grand Knight/Faithful Captain
- 1 Program Director
- 1 Membership Director
- Unlimited Knight/Sir Knight

*Note: The role on the right of each / is for the assembly. Both assembly and council can have a program director and a membership director.*

## User Authentication Flow

1. All unauthenticated users start at the login/main screen
2. Can maintain authentication for previously authenticated users
3. User authenticates - new users have their authentication saved in Supabase, as well as user data in the users table
4. User access level is determined by the users table and access is granted based on those roles
5. New users will be given basic access (assumed to be Knight or Sir Knight)
6. User's subscription status is checked with RevenueCat - higher access users are denied access to their normal areas and sent to a subscription renewal screen if expired
7. Consider having brand new users default to the profile screen so they can fill in their user data and roles, save their profile data, and then go to the main/Home screen (but only on the first time)

## Profile Screen

### Required Data
- First Name
- Last Name
- Membership Number
- Council Number
- Council Role

### Optional Data
- Assembly Number
- Assembly Role

### Additional Features
- Full Access users can enter the Define Programs area and create new programs, edit/toggle programs on/off (both system defaults and previously created customs)
- All users can sign out
- Consider adding a Delete Account button that allows users to delete their personal data (their line in the users table, any volunteer hours they have logged), but won't delete other data they've submitted as it plays into other reports and is still valid (that data belongs to the organization, not the individual)

## Define Programs Screen

### Program Management
- System default programs exist for councils and assemblies (some are the same, others are specific to councils or assemblies)
- Full access users can toggle programs on or off as their organization participates in them (active/inactive)
- They can add custom programs for their organization and toggle them on and off
- When programs are toggled on/off, it determines visibility in drop downs in other components
- If a user toggles off "Wheelchair Mission," no one in their organization will see that as a choice in logging program participation, income, expenses, etc.
- Active/inactive program choices should be saved in the database so any member of the same organization sees the same active/inactive programs in their dropdown menus (saved in Organizations table)

## Organization Choice/Buttons/Toggles

### Organization-Specific Data View
- When a user is in one organization or the other (council or assembly), all data they see is based on that group
- If on council, they only see their council's data, not their assembly's data
- If in assembly, they don't see council data
- Access to areas is limited or unlimited based on their access for that organization, which can be completely different from the other

### Example Access Scenario
- User is a Knight in council (basic access) but Faithful Comptroller in assembly (full access)
- Finance would not be visible when toggled to council, but would be accessible with full permissions when toggled to assembly

## Main/Home Screen

Personal dashboard area where users can add whatever components they want on their dashboard:
- Income and expenses entry components
- Program budget check component
- Any other desired components
- Users can choose to have nothing if preferred

### Navigation
- Navbar at the bottom with access to approved areas
- Organization buttons at the top
- If user hasn't provided assembly number and role, Assembly button is disabled
- Council is never disabled (user must be a member of a council)
- Organization buttons always default to Council when moving into other screens/components

## Programs

### Access and Functionality
- All users can log programs regardless of access level
- User chooses appropriate organization button to proceed
- User submits data about programs they ran (e.g., "Movie Knight" - a custom program)
- Data gets saved into the Programs table

### View Log Feature
- When user toggles on View Log, shows previously submitted entries (including current ones)
- Newest entries on top
- Grouped by year/month (July 2025 shows first, then June, etc.)
- Each grouping can be collapsed for easier viewing
- Log shows all entries submitted for that organization by any user in that organization
- User only sees entries for one organization at a time (switching from council 15857 to 539 hides all 15857 entries)

## Hours

### Access and Functionality
- All users can log volunteer hours regardless of access level
- User chooses appropriate organization button to proceed
- User submits data about hours they volunteered (e.g., hours spent running "Movie Knight")
- Data gets saved into hours_entries table

### View Log Feature
- Same grouping and display functionality as Programs
- Users can edit or delete their previously submitted entries
- User only sees their own entries, regardless of access or organization
- User can see all their data even if they switch councils

## Finance

### Access Requirements
- Not accessible for anyone less than full users
- Finance shouldn't even display on the navbar for non-full users

### Functionality
- User submits income or expense entries
- Entries submit into finance_entries table
- View log works the same as other screens
- Full users can edit or delete previously submitted entries

## Reports

### Balance Sheet
- **Access:** Full access only
- Breaks down all financial entries, totaling for each program by month
- Separates income and expense entries (e.g., parish breakfast has separate lines for income and expenses)
- All 12 months in the calendar year are their own columns

### Annual Budget Report
- **Access:** Full access only
- Provides fields for users to submit budget numbers for each program
- Saves data into budget_entries table
- Budget numbers for upcoming year can be changed until the beginning of the year
- Once new year starts, those numbers are set and cannot be changed
- Example: In 2025, can change 2026 budget numbers freely, but whatever is saved before Jan 1, 2026 becomes the set budget for 2026

### Semi-Annual Audit Report
- **Access:** Full access only
- Pulls data from financial data within selected period
- Collects user-entered data
- Runs calculations from all data to fill in a fill-in PDF
- Uses Supabase functions to help fill in the PDF

### Form 1728
- **Access:** Read or Full Access
- Pulls data from submitted programs data for a calendar year
- Fills in a fill-in PDF

### Program Budget
- **Access:** Read or Full Access
- Reads chosen program budget number from submitted budget for matching year (e.g., $500)
- Pulls income and expense entries to calculate current totals (e.g., income $250, expenses $375)
- Calculates remaining budget: (income $250 - expenses $375 = -$125, then adds/subtracts from approved budget ($500), so total budget left would be $375)

### Volunteer Hours
- **Access:** All access levels
- Totals volunteer hours for a calendar year for that user based on their submitted hours

## Reimbursement System

### Access
- **Basic Access Users** can submit reimbursement requests

### Reimbursement Submission Flow

#### Initial Submission
1. User clicks on "Receipts" (or similar navigation item)
2. User chooses their organization so the receipt goes to the correct one (based on profile page data - submission will be denied if sent to wrong organization)
3. User enters required information:
   - First and Last Name
   - Email Address
   - Phone Number
   - Program (based on Define Programs toggles)
   - Description of what the receipt is for (e.g., program may be "Movie Knight" but receipt is for "food purchases")
   - Amount

#### Receipt Documentation
User can submit supporting documentation via:
- PDF upload
- Previously saved image (JPG/PNG from email or photo taken earlier)
- Take a picture at that time and immediately add for submission

#### Payment Details
- Specify if reimbursement is for them or for something else (e.g., John Doe can submit a request for a donation to Special Olympics and it will be written to Special Olympics of Colorado)
- Choose payment method:
  - Check at next meeting
  - Mailed check
- Provide mailing address (their address or somewhere else entirely)

#### Submission
Once user is satisfied with all information, they submit the request

### Approval Process

#### Initial Review
1. Notification is sent to the organization's financial officer (Financial Secretary or Comptroller) of the submission
2. Financial officer can review and either:
   - **Approve:** Proceeds to voucher generation
   - **Deny:** Must provide reason for denial

#### Denial Process
- If denied, email is generated back to submitting user with reason for denial
- User can correct and resubmit or choose not to resubmit

#### Approval Process
- If approved, submission becomes a voucher with unique number
- Voucher numbering system: CE013 (13th voucher for Council (C) that is submitted Electronically (E))
- Note should be included for officer to not submit an expense entry for this as it will be generated automatically

### Payment Processing
1. Notification/email is sent to the other financial officer (Treasurer/Purser) notifying them of approved voucher
2. They are instructed to write a check
3. They will either:
   - Save the check for the next meeting, or
   - Mail as user specified on submission
4. The expense is automatically submitted into the expense entries (same as manually entered finance expenses)